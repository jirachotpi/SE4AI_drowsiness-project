# --- backend/app/models/models.py ---
from pydantic import BaseModel, EmailStr, Field
from datetime import datetime, timedelta
from typing import Optional  # üí° [‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà] ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Optional ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å

# üí° ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢ (UTC+7)
def get_thai_time():
    return datetime.utcnow() + timedelta(hours=7)

# 1. ‡πÅ‡∏ö‡∏ö‡πÅ‡∏õ‡∏•‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å"
class UserRegister(BaseModel):
    username: str = Field(..., min_length=3)
    email: EmailStr
    password: str = Field(..., min_length=6)
    # üí° [‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà] ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß (‡πÉ‡∏™‡πà Optional ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å‡πÉ‡∏ô‡∏ö‡∏≤‡∏á‡∏Å‡∏£‡∏ì‡∏µ)
    department: Optional[str] = ""
    phone: Optional[str] = ""
    age: Optional[int] = None
    gender: Optional[str] = ""

# 2. ‡πÅ‡∏ö‡∏ö‡πÅ‡∏õ‡∏•‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö"
class UserLogin(BaseModel):
    username: str
    password: str

# 3. ‡πÅ‡∏ö‡∏ö‡πÅ‡∏õ‡∏•‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö LOGGING
class LogEntry(BaseModel):
    user_id: str
    event_type: str       # ‡πÄ‡∏ä‡πà‡∏ô "drowsy", "deep_sleep", "staring"
    ear_value: float      # ‡∏Ñ‡πà‡∏≤ EAR ‡∏ì ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏´‡∏ï‡∏∏
    duration_ms: int = 0  # ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏ö (ms)
    # üí° ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ Default ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Database ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    timestamp: datetime = Field(default_factory=get_thai_time)